<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - DateFlow</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #E11D48;
            --primary-hover: #BE123C;
            --background: #0A0A0B;
            --background-secondary: #111113;
            --surface: #18181B;
            --surface-hover: #27272A;
            --border: #27272A;
            --text-primary: #FAFAFA;
            --text-secondary: #A1A1AA;
            --text-muted: #71717A;
            --success: #22C55E;
            --warning: #F59E0B;
            --error: #EF4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .profile-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-decoration: none;
        }

        .header-btn svg { width: 20px; height: 20px; stroke: white; }

        .photo-gallery {
            position: relative;
            width: 100%;
            height: 70vh;
            min-height: 400px;
            max-height: 600px;
        }

        .photo-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .photo-slide.active { opacity: 1; }

        .photo-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-nav {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            display: flex;
        }

        .photo-nav-area {
            flex: 1;
            cursor: pointer;
        }

        .photo-indicators {
            position: absolute;
            top: 70px;
            left: 20px;
            right: 20px;
            display: flex;
            gap: 4px;
        }

        .photo-indicator {
            flex: 1;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }

        .photo-indicator.active { background: white; }

        .profile-info {
            position: relative;
            margin-top: -40px;
            background: var(--background);
            border-radius: 24px 24px 0 0;
            padding: 24px 20px;
            padding-bottom: 120px;
        }

        .name-section {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .name-section h1 { font-size: 28px; font-weight: 700; }

        .age {
            font-size: 24px;
            font-weight: 300;
            color: var(--text-secondary);
        }

        .verified-badge {
            width: 24px;
            height: 24px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .verified-badge svg { width: 14px; height: 14px; stroke: white; }

        .location {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-muted);
            font-size: 14px;
            margin-bottom: 20px;
        }

        .location svg { width: 16px; height: 16px; stroke: currentColor; }

        .bio-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .bio-text {
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .interests-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .interest-tag {
            padding: 8px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(to top, var(--background) 80%, transparent);
            display: flex;
            justify-content: center;
            gap: 16px;
        }

        .action-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn svg { width: 28px; height: 28px; }

        .btn-pass {
            background: var(--surface);
            border: 2px solid var(--border);
        }

        .btn-pass:hover { background: var(--surface-hover); }
        .btn-pass svg { stroke: var(--text-muted); }

        .btn-like {
            width: 70px;
            height: 70px;
            background: var(--primary);
            box-shadow: 0 4px 20px rgba(225, 29, 72, 0.4);
        }

        .btn-like:hover { transform: scale(1.05); }
        .btn-like svg { fill: white; stroke: none; }

        .btn-message {
            background: var(--surface);
            border: 2px solid var(--primary);
        }

        .btn-message:hover { background: var(--surface-hover); }
        .btn-message svg { stroke: var(--primary); }

        .menu-dropdown {
            position: absolute;
            top: 60px;
            right: 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 8px;
            display: none;
            min-width: 160px;
            z-index: 200;
        }

        .menu-dropdown.show { display: block; }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .menu-item:hover { background: var(--surface-hover); }
        .menu-item svg { width: 18px; height: 18px; stroke: currentColor; }
        .menu-item.danger { color: var(--error); }

        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 14px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        @media (min-width: 768px) {
            .photo-gallery { height: 80vh; max-height: 700px; }
            .profile-info { max-width: 600px; margin: -40px auto 0; }
            .action-bar { max-width: 600px; left: 50%; transform: translateX(-50%); }
        }
    </style>
</head>
<body>
    <header class="profile-header">
        <a href="matches.html" class="header-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
        </a>
        <button class="header-btn" onclick="toggleMenu()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="19" cy="12" r="1"></circle>
                <circle cx="5" cy="12" r="1"></circle>
            </svg>
        </button>
        <div class="menu-dropdown" id="menuDropdown">
            <div class="menu-item" onclick="reportUser()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                    <line x1="4" y1="22" x2="4" y2="15"></line>
                </svg>
                Report User
            </div>
            <div class="menu-item danger" onclick="blockUser()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                </svg>
                Block User
            </div>
        </div>
    </header>

    <div class="photo-gallery" id="photoGallery">
        <div class="photo-slide active">
            <img src="/placeholder.svg?height=600&width=400" alt="Profile photo">
        </div>
        <div class="photo-slide">
            <img src="/placeholder.svg?height=600&width=400" alt="Lifestyle photo">
        </div>
        <div class="photo-slide">
            <img src="/placeholder.svg?height=600&width=400" alt="Travel photo">
        </div>
        <div class="photo-nav">
            <div class="photo-nav-area" onclick="prevPhoto()"></div>
            <div class="photo-nav-area" onclick="nextPhoto()"></div>
        </div>
        <div class="photo-indicators" id="photoIndicators">
            <div class="photo-indicator active"></div>
            <div class="photo-indicator"></div>
            <div class="photo-indicator"></div>
        </div>
    </div>

    <div class="profile-info">
        <div class="name-section">
            <h1 id="userName">Sarah</h1>
            <span class="age" id="userAge">28</span>
            <div class="verified-badge" id="verifiedBadge" title="Verified profile">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
        </div>
        <div class="location">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <span id="userLocation">5 miles away</span>
        </div>

        <div class="bio-section">
            <h3 class="section-title">About</h3>
            <p class="bio-text" id="userBio">
                Adventure seeker and coffee enthusiast. I love exploring new places, trying exotic foods, and having deep conversations about life. Looking for someone who can make me laugh and isn't afraid to be themselves. Let's create some amazing memories together!
            </p>
        </div>

        <div class="bio-section">
            <h3 class="section-title">Interests</h3>
            <div class="interests-grid" id="interestsGrid">
                <span class="interest-tag">Travel</span>
                <span class="interest-tag">Photography</span>
                <span class="interest-tag">Coffee</span>
                <span class="interest-tag">Hiking</span>
                <span class="interest-tag">Reading</span>
                <span class="interest-tag">Cooking</span>
            </div>
        </div>
    </div>

    <div class="action-bar">
        <button class="action-btn btn-pass" onclick="passUser()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <button class="action-btn btn-like" onclick="likeUser()">
            <svg viewBox="0 0 24 24">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
        </button>
        <button class="action-btn btn-message" onclick="messageUser()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        </button>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const API_BASE = 'http://localhost:8000';
        const token = localStorage.getItem('dateflow_token');
        
        if (!token) {
            window.location.href = 'authentication.html';
        }

        // Get user ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('id');

        let currentPhoto = 0;
        const slides = document.querySelectorAll('.photo-slide');
        const indicators = document.querySelectorAll('.photo-indicator');

        function showPhoto(index) {
            slides.forEach((s, i) => {
                s.classList.toggle('active', i === index);
                indicators[i]?.classList.toggle('active', i === index);
            });
            currentPhoto = index;
        }

        function nextPhoto() {
            const next = (currentPhoto + 1) % slides.length;
            showPhoto(next);
        }

        function prevPhoto() {
            const prev = (currentPhoto - 1 + slides.length) % slides.length;
            showPhoto(prev);
        }

        function toggleMenu() {
            document.getElementById('menuDropdown').classList.toggle('show');
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.header-btn') && !e.target.closest('.menu-dropdown')) {
                document.getElementById('menuDropdown').classList.remove('show');
            }
        });

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        async function likeUser() {
            try {
                const res = await fetch(`${API_BASE}/matches/like/${userId}`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (res.ok) {
                    const data = await res.json();
                    if (data.is_match) {
                        showToast("It's a match! ðŸŽ‰");
                    } else {
                        showToast("Like sent!");
                    }
                    setTimeout(() => window.location.href = 'matches.html', 1500);
                }
            } catch (err) {
                showToast("Could not send like");
            }
        }

        async function passUser() {
            try {
                await fetch(`${API_BASE}/matches/pass/${userId}`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                window.location.href = 'matches.html';
            } catch (err) {
                showToast("Could not pass");
            }
        }

        function messageUser() {
            window.location.href = `messages.html?user=${userId}`;
        }

        function reportUser() {
            window.location.href = `report.html?user=${userId}`;
        }

        async function blockUser() {
            if (confirm('Are you sure you want to block this user? They will no longer be able to see or contact you.')) {
                try {
                    const res = await fetch(`${API_BASE}/users/block/${userId}`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    
                    if (res.ok) {
                        showToast("User blocked");
                        setTimeout(() => window.location.href = 'matches.html', 1500);
                    }
                } catch (err) {
                    showToast("Could not block user");
                }
            }
        }

        // Load user profile
        async function loadProfile() {
            if (!userId) {
                window.location.href = 'matches.html';
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/users/${userId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (res.ok) {
                    const user = await res.json();
                    document.getElementById('userName').textContent = user.display_name || 'User';
                    document.getElementById('userAge').textContent = user.age || '';
                    document.getElementById('userBio').textContent = user.bio || 'No bio yet';
                    document.getElementById('userLocation').textContent = user.location || 'Location unknown';
                    
                    if (!user.is_verified) {
                        document.getElementById('verifiedBadge').style.display = 'none';
                    }

                    if (user.interests && user.interests.length) {
                        document.getElementById('interestsGrid').innerHTML = user.interests
                            .map(i => `<span class="interest-tag">${i}</span>`).join('');
                    }

                    if (user.photos && user.photos.length) {
                        const gallery = document.getElementById('photoGallery');
                        const indicatorsContainer = document.getElementById('photoIndicators');
                        
                        gallery.querySelectorAll('.photo-slide').forEach(s => s.remove());
                        indicatorsContainer.innerHTML = '';

                        user.photos.forEach((photo, i) => {
                            const slide = document.createElement('div');
                            slide.className = `photo-slide ${i === 0 ? 'active' : ''}`;
                            slide.innerHTML = `<img src="${photo}" alt="Photo ${i + 1}">`;
                            gallery.insertBefore(slide, gallery.querySelector('.photo-nav'));

                            const indicator = document.createElement('div');
                            indicator.className = `photo-indicator ${i === 0 ? 'active' : ''}`;
                            indicatorsContainer.appendChild(indicator);
                        });
                    }
                }
            } catch (err) {
                console.error('Failed to load profile');
            }
        }

        loadProfile();
    </script>
</body>
</html>
